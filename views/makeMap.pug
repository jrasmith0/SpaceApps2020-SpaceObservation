doctype HTML
head
	title Above the Horizon
	link(rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" integrity="sha384-JcKb8q3iqJ61gNV9KGb8thSsNjpSL0n8PARn9HuZOnIxN0hoP+VmmDGMN5t9UJ0Z" crossorigin="anonymous")
	link(rel="stylesheet" href="css/main.css")
	script(src="js/stuquery.min.js" type="text/javascript")
	script(src="https://code.jquery.com/jquery-1.12.4.min.js")
	script(src="js/virtualsky.min.js" type="text/javascript")
	script.
		S(document).ready(function() {
			let lat, long;
			let searchParams = new URLSearchParams(window.location.search)

			var planetarium = S.virtualsky({
				id: 'starmap',
				projection: 'stereo'
			});

			function positionErrorHandler(err) {
				if (err.code == 1) {
					alert("Error: Access is denied!");
				} else if (err.code == 2) {
					alert("Error: Position is unavailable!");
				}
			}

			function getLocation() {
				if (navigator.geolocation) {
					var options = {timeout: 60000};
					navigator.geolocation.getCurrentPosition(showPosition, positionErrorHandler, options);
				} else {
					console.log("Geolocation not supported");
				}
			}
			
			function showPosition(position) {
				if (position.latitude === undefined || position.longitude === undefined) {
					generateURL(43.6532, 79.3832)
				} else {
					generateURL(position.latitude, position.longitude)
				}
			}

			function generateURL(latitude, longitude) {
				var url = window.location.href.split('?')[0] + "?lat=" +  latitude + "&long=" + longitude;
				window.location = url;
			}

			document.getElementById("update").addEventListener("click", updateLocation, false);

			function updateLocation() {
				latitude = document.getElementById('latitude').value;
				longitude = document.getElementById('longitude').value;
				generateURL(latitude, longitude);
			}
			
			if (document.location.search.length) {
				lat = searchParams.get('lat');
				long = searchParams.get('long');
				planetarium.setLatitude(lat);
				planetarium.setLongitude(long);
				planetarium.moveIt();
			} else {
				getLocation();
			}

			var json = !{JSON.stringify(jsonList)};

			for(let i =0; i < 6; i++){
				let ra = json[i]['\"RA (J2000']['0)\"'];
				let dec = json[i]['\"Dec'][' (J2000']['0)\"'];
				let name =  json[i]['\"Target Name\"']
				planetarium.addPointer({
					'ra':ra,
					'dec':dec,
					'label': name,
					'colour':'rgb(255,220,220)'
				})
			}

			planetarium.addPointer({
				'ra':83.8220792,
				'dec':-5.3911111,
				'label':'Orion Nebula',
				'img':'http://server7.sky-map.org/imgcut?survey=DSS2&w=128&h=128&ra=5.58813861333333&de=-5.3911111&angle=1.25&output=PNG',
				'url':'worldWind.html?pos=35,139,10000000&loc=' + lat + ',' + long,
				'colour':'rgb(255,220,220)'
			})
			
		});


body
	nav(class="navbar navbar-expand-md navbar-dark bg-dark fixed-top")
		a(class="navbar-brand" href="#") ORBITAL VIEW
		div(class="form-inline my-2 my-lg-0 right-align-form")
			input(id="latitude" class="form-control mr-sm-2" type="text" placeholder="Latitude" aria-label="Latitude")
			input(id="longitude" class="form-control mr-sm-2" type="text" placeholder="Longtitude" aria-label="Longitude")
			button(id="update" class="btn btn-outline-success my-2 my-sm-0" type="button") Update

	div(class="main-container")
		div(id="sidebar-wrapper" class="bg-light border-right")
			div(class="list-group list-group-flush")
				span(class="list-group-item list-group-item-action bg-light") Time
					br
					br
					input(type="time" class="sidenavInput" id="time" name="time")
					br
					br
					button(id="submitTime" class="btn my-2 my-sm-0 btn-outline-dark" type="button") Update Time
				span(class="list-group-item list-group-item-action bg-light") Date
					br
					br
					input(type="date" class="sidenavInput" id="date" name="date")
					br
					br
					button(id="submitDate" class="btn my-2 my-sm-0 btn-outline-dark" type="button") Update Date
				span(class="list-group-item list-group-item-action bg-light") Latitude
					br
					br
					input(type="text" class="sidenavInput" id="latitudeValue" name="latitudeValue")
					br
					br
					button(id="submitLatitude" class="btn my-2 my-sm-0 btn-outline-dark" type="button") Update Latitude
				span(class="list-group-item list-group-item-action bg-light") Longitude
					br
					br
					input(type="text" class="sidenavInput" id="longitudeValue" name="longitudeValue")
					br
					br
					button(id="submitLongitude" class="btn my-2 my-sm-0 btn-outline-dark" type="button") Update Longitude
		div(id="starmap")