doctype HTML
head
	link(rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" integrity="sha384-JcKb8q3iqJ61gNV9KGb8thSsNjpSL0n8PARn9HuZOnIxN0hoP+VmmDGMN5t9UJ0Z" crossorigin="anonymous")
	link(rel="stylesheet" href="main.css")
	script(src="stuquery.min.js" type="text/javascript")
	script(src="https://code.jquery.com/jquery-1.12.4.min.js")
	script(src="virtualsky.min.js" type="text/javascript")
	script.
		S(document).ready(function() {
			let lat, long;
			let searchParams = new URLSearchParams(window.location.search)

			var planetarium = S.virtualsky({
				id: 'starmap',
				projection: 'stereo'
			});

			function getLocation() {
				if (navigator.geolocation) {
					navigator.geolocation.getCurrentPosition(showPosition);
				} else {
					console.log("Geolocation not supported");
				}
			}

			function showPosition(position) {
				generateURL(position.latitude, position.longitude)
			}

			function generateURL(latitude, longitude) {
				var url = "http://localhost:3000/?lat=" +  latitude + "&long=" + longitude;
				window.location = url;
			}

			document.getElementById("update").addEventListener("click", updateLocation, false);

			function updateLocation() {
				latitude = document.getElementById('latitude').value;
				longitude = document.getElementById('longitude').value;
				generateURL(latitude, longitude);
			}
			
			if (document.location.search.length) {
				lat = searchParams.get('lat');
				long = searchParams.get('long');
				planetarium.setLatitude(lat);
				planetarium.setLongitude(long);
				planetarium.moveIt();
			} else {
				getLocation();
			}

			planetarium.addPointer({
				'ra':83.8220792,
				'dec':-5.3911111,
				'label':'Orion Nebula',
				'img':'http://server7.sky-map.org/imgcut?survey=DSS2&w=128&h=128&ra=5.58813861333333&de=-5.3911111&angle=1.25&output=PNG',
				'colour':'rgb(255,220,220)'
			})
			
		});


body
	nav(class="navbar navbar-expand-md navbar-dark bg-dark fixed-top")
		a(class="navbar-brand" href="#") Placeholder
		div(class="form-inline my-2 my-lg-0 right-align-form")
			input(id="latitude" class="form-control mr-sm-2" type="text" placeholder="Latitude" aria-label="Latitude")
			input(id="longitude" class="form-control mr-sm-2" type="text" placeholder="Longtitude" aria-label="Longitude")
			button(id="update" class="btn btn-outline-success my-2 my-sm-0" type="button") Update

	div(class="main-container")
		div(id="starmap")