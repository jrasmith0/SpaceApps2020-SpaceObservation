<!DOCTYPE HTML>
<head>
	<script src="stuquery.min.js" type="text/javascript"></script>
	<script src="https://code.jquery.com/jquery-1.12.4.min.js"></script>
	<script src="virtualsky.min.js" type="text/javascript"></script>
	<script>
		S(document).ready(function() {
			let lat, long;
			let searchParams = new URLSearchParams(window.location.search)

			var planetarium = S.virtualsky({
				id: 'starmap1',
				projection: 'stereo'
			});

			function getLocation() {
				if (navigator.geolocation) {
					navigator.geolocation.getCurrentPosition(showPosition);
				} else {
					console.log("Geolocation not supported");
				}
			}

			function showPosition(position) {
				generateURL(position.coords)
			}

			function generateURL(coords) {
				var url = "http://localhost:3000/?lat=" +  coords.latitude + "&long=" +coords.longitude;
				window.location = url;
			}
			
			if (document.location.search.length) {
				lat = searchParams.get('lat');
				long = searchParams.get('long');
				planetarium.setLatitude(lat);
				planetarium.setLongitude(long);
				planetarium.moveIt();
			} else {
				getLocation();
			}

			planetarium.addPointer({
				'ra':83.8220792,
                'dec':-5.3911111,
                'label':'Orion Nebula',
                'img':'http://server7.sky-map.org/imgcut?survey=DSS2&w=128&h=128&ra=5.58813861333333&de=-5.3911111&angle=1.25&output=PNG',
                'url':'http://simbad.u-strasbg.fr/simbad/sim-id?Ident=M42',
                'credit':'Wikisky',
                'colour':'rgb(255,220,220)'
			})
			
		});
		
	</script>
</head>

<body>
	<div id="starmap1" style="width:400px;height:400px;"></div>
	<p id="location"></p>
</body>
